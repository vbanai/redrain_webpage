<!-- https://www.youtube.com/watch?v=etsPyHLON7g&t=990s -->
<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Website with Login & Registration Form</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="static/styledashboard.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='header.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='body.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Bootstrap CSS (v5.3 CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUU5w"
          crossorigin="anonymous">

    <style>
  
       .image-container {
            width: 300px; /* Set a specific width */
            display: grid; /* Use flexbox for centering image */
            justify-content: center; /* Center horizontally */
            place-items: center; /* Center vertically */
            overflow: hidden; /* Ensure image does not overflow */
        }
        .image-container img {
            max-width: 100%; /* Maximum width of the image is the container width */
            max-height: 90%; /* Maximum height of the image is the container height */
            height: auto; /* Maintain aspect ratio */
        }
        .right-section2 {
      width: 60px;
      display: flex;
      align-items: center;
      justify-content: right;
      margin-right: 20px;
      margin-left: 20px;
      flex-shrink: 0;
      
    }
    .canvas {
      width: 100% !important;
      height: 100% !important;
    }
    .language-switcher {
        display: flex;
        align-items: center;
        margin-right: 7px;  /* Space between the flags and login button */
        width: auto;
        font-size: 0;  /* Remove space between inline elements */
      }

      .language-switcher a {
        
        margin-right: 7px;
        text-decoration: none;
      }

      .language-switcher img {
        width: 19px;  /* Smaller flag size */
        height: 13px;  /* Smaller flag size */
      }

      /* Make Hungarian flag slightly larger */
      .language-switcher a:nth-child(2) img {
        width: 15px;  /* Hungarian flag size */
        height: 10px;  /* Hungarian flag size */
      }

      body.loading #dashboardContent {
        filter: blur(5px);
        pointer-events: none;
      }
    
    </style>

  </head>
  <body class="loading">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: white; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
      <div id="loadingText" style="margin-top: 1rem; font-size: 1.2rem;">Loading</div>
    </div>

    
    <div class="header0">
      <div class="left-section">
        <img src="static/RedRainLogo8.png" alt="" class="hamburger">
      </div>
      <div class="middle-section">
        
        <li class="nav_item" id="navItem">
          <a href="#home" class="nav_link buttonsubscription" style="font-size: clamp(0.8rem, 1.2vw, 1.03rem);" id="home" data-lang="home">Home</a>
          <a href="#contact" class="nav_link buttonsubscription" style="font-size: clamp(0.8rem, 1.2vw, 1.03rem);" id="form-open" data-lang="customdatemetrics">Custom Data Metrics</a>
        </li>
          
        
          
          
       
        
        
      </div>
      <div class="right-section2">
        <div class="language-switcher">
          
            <a href="#" id="lang-en" class="language-link">
              <img src="static/en-flag.png" alt="EN" />
            </a><a href="#" id="lang-hu" class="language-link">
              <img src="static/hu-flag.png" alt="HU" />
            </a>
          
        </div>
        <div class="circle-container">
          <div class="circle" id="circleDropdown">
            <div class="content">
              {{First_character}} <!-- Your character or content here -->
            </div>
          </div>
          <div class="circle-dropdown-content" id="circleDropdownContent">
            <a href="{{url_for('serviceselector_vbanai')}}" id="circleDashboardLink" data-lang="dashboard">Dashboard</a>
            {% if chat_control_access %}
              <a href="#service1" id="circleDashboardLink0" data-lang="chatcontrol">Chat Control</a>
            {% endif %}
     
            {% if advanced_ai_access and user_role in ['Manager', 'Team Leader'] %}
              <a href="{{ url_for('predictive_dashboard') }}" data-lang="prediction">Advanced AI Predictive Solutions</a>
            {% endif %}
              <a href="#logout" id="logout" action="{{ url_for('logout') }}" method="post" data-lang="logout">Logout</a>
          </div>
        </div>
        
        <!-- <a href="#home" class="buttonlogout" id="form-open">Logout</a> -->
        
      </div>
       
      
     
    </div> 
    <!-- <div id="flash-messages-container">

      {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
              <div class="flash-messages">
                  {% for category, message in messages %}
                      <div class="flash-message {{ category }}">
                          {{ message }}
                      </div>
                  {% endfor %}
              </div>
          {% endif %}
      {% endwith %}
    </div> -->
    <!-- Home -->
    <section class="home">
      <div class="form_container active">
        <i class="uil uil-times form_close"></i>
        
<!-- Form of Orders -->
        <div class="form signup_form">
          <form id="submitForm" action="/topicMonitoring" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
           
            <h2 data-lang="customdatemetrics">Custom Date Metrics</h2>
            
            <div class="input_group">
              <p class="input_group_label" data-lang="pleasespecifythestartdate">Please specify the start date:</p>
              <div class="input_box">
                <input type="text" name="year_start" data-lang="startdateyear" placeholder="Year (2024)" required style="font-size: clamp(0.34rem, 0.6vw, 0.9rem);" />
              </div>
              <div class="input_box">
                <input type="text" name="month_start" data-lang="startdatemonth" placeholder="Month (01)" required style="font-size: clamp(0.34rem, 0.6vw, 0.9rem);"/>
              </div>
              <div class="input_box">
                <input type="text" name="day_start" data-lang="startdateday" placeholder="Day (01)" required style="font-size: clamp(0.34rem, 0.6vw, 0.9rem);"/>
              </div>
              <div class="input_box">
                <input type="text" name="hour" data-lang="startdatehour" placeholder="Hour (00)" style="font-size: clamp(0.34rem, 0.6vw, 0.9rem);" />
              </div>
              <div class="input_box">
                <input type="text" name="minutes" data-lang="startdateminute" placeholder="Minute (00)" style="font-size: clamp(0.34rem, 0.6vw, 0.9rem);" />
              </div>
              <div class="input_box">
                <input type="text" name="seconds" data-lang="startdatesecond" placeholder="Second (00)" style="font-size: clamp(0.34rem, 0.6vw, 0.9rem);" />
              </div>
            </div>

            
            <div class="input_group">
              <p class="input_group_label" data-lang="pleasespecifytheenddate">Please specify the end date:</p>
              <div class="input_box">
                <input type="text" name="year_end" data-lang="enddateyear" placeholder="Year (2024)" required style="font-size: clamp(0.34rem, 0.6vw, 0.9rem);"/>
              </div>
              <div class="input_box">
                <input type="text" name="month_end" data-lang="enddatemonth" placeholder="Month (02)" required style="font-size: clamp(0.34rem, 0.6vw, 0.9rem);"/>
              </div>
              <div class="input_box">
                <input type="text" name="day_end" data-lang="enddateday" placeholder="Day (01)" required style="font-size: clamp(0.34rem, 0.6vw, 0.9rem);"/>
              </div>
              <div class="input_box">
                <input type="text" name="hour_end" data-lang="enddatehour" placeholder="Hour (00)" style="font-size: clamp(0.34rem, 0.6vw, 0.9rem);" />
              </div>
              <div class="input_box">
                <input type="text" name="minutes_end" data-lang="enddateminute" placeholder="Minute (00)" style="font-size: clamp(0.34rem, 0.6vw, 0.9rem);" />
              </div>
              <div class="input_box">
                <input type="text" name="seconds_end" data-lang="enddatesecond" placeholder="Second (00)" style="font-size: clamp(0.34rem, 0.6vw, 0.9rem);" />
              </div>
            </div>
            <div class="row">
              <p class="input_group_label" data-lang="trackedperiod">Please specify the periods you want to track:</p>
              <div class="dropdown-container">
                  <div class="dropdown">
                      <select name="frequency" id="frequency" style="width: 67px;">
                          <option value="yearly" data-lang="yearly">Yearly</option>
                          <option value="monthly"  data-lang="monthly">Monthly</option>
                          <option value="weekly" data-lang="weekly">Weekly</option>
                          <option value="daily" data-lang="daily">Daily</option>
                      </select>
                  </div>
              </div>
            </div>

            

            <div>
              
              <input class="button" type="submit" data-lang="submit_" value="">
            </div>
          
          </form>
        </div>
      </div>
      <div class="basicwrapper" style="
        position: absolute;
        top: 100px;
        left: 5%;
        right: 5%;
        width: 90%;
        max-width: 100vw;
    
        ">

        <div>
          <div style="
          display: flex;
          flex-direction: row;  justify-content: center; margin-bottom: 2%;">
            <p style="font-size:1.5rem; font-weight: 400; color: rgb(241, 239, 239); ;
             border-radius: 15px; " data-lang="weektodatequickoverview">Week-to-Date Quick Overview </p>
          </div>
          <!-- Wrapper Container -->
          <div style="display: flex; justify-content: space-between;" class="main-container">
            <!-- Left Column -->
            <div class="left-column" style="flex: 1; max-width: 54%; width: calc(100vw - 46%);">
              <div style="display: flex; flex-direction: column;">
                <div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%; height: 12vw;">
                  <div style="background-color: rgba(255, 255, 255, 0.9); width: 23%; border-radius: 6px; overflow: hidden">
                    <p class="user-text" style="margin-top: 6px; font-size: 1vw"><i class="fa-solid fa-user" style="color: #5b5b5b; margin-right: 2px; margin-left: 15px;"></i> <span data-lang="users">users</span> </p>
                    <p id="usernumber" style="font-size: 1.8vw; margin-top: 6px; color:rgb(31, 7, 116); text-align: center;">{{usernumber}}</p>
                    <p id="percentage" style="text-align: center; font-size: 1.3vw; color:rgb(38, 152, 57)"><i class="fa-solid fa-arrow-up" "></i> 25% </p>
                    <p data-lang="vs_previous_week" style="text-align: center; font-size: 1vw; margin-bottom: 12px;">vs previous week</p>
                  </div>
                  <div style="background-color: rgba(255, 255, 255, 0.9); width: 23%; border-radius: 6px;">
                    <p class="query" style="margin-top: 6px; font-size: 1vw"><i class="fa-solid fa-clipboard-question" style="color: #5b5b5b; margin-right: 2px; margin-left: 15px;"></i> <span data-lang="query">query</span></p>
                    <p style="font-size: 1.8vw; margin-top: 6px; color:rgb(31, 7, 116); text-align: center;">{{average_userquerry}}</p>
                    <p data-lang="on_average" style="text-align: center; font-size: 1.3vw; color:rgb(38, 152, 57)"> on average </p>
                    <p data-lang="per_user" style="text-align: center; font-size: 1vw; margin-bottom: 12px;">per user</p>
                  </div>
                  <div onclick="window.open('/chats_in_requested_period_weekly?year_end={{today_year}}&month_end={{ today_month }}&day_end={{ today_day }}&hour_end={{ today_hour }}&minutes_end={{ today_minute }}&seconds_end={{ today_second }}&year={{ previous_monday_year }}&month={{ previous_monday_month }}&day={{ previous_monday_day }}&hour={{ previous_monday_hour }}&minutes={{ previous_monday_minute }}&seconds={{ previous_monday_second }}', '_blank');" style="background-color: rgba(255, 255, 255, 0.9); width: 23%; border-radius: 6px; cursor: pointer; ">
                    <p class="user-chats" style="margin-top: 6px; font-size: 1vw"><i class="fa-solid fa-comments" style="color: #5b5b5b; margin-right: 2px; 
                    margin-left: 15px;"></i> <span data-lang="chats">chats</span></p>
                    <p data-lang="click" style="font-size: 1.8vw; margin-top: 6px; color:rgb(31, 7, 116); text-align: center;">click</p>
                    <p data-lang="to_read" style="text-align: center; font-size: 1.3vw; color:rgb(38, 152, 57)"> to read </p>
                    <p data-lang="this_week_chats" style="text-align: center; font-size: 1vw; margin-bottom: 12px;">this week's chats</p>
                  </div>
                  <div style="background-color: rgba(255, 255, 255, 0.9); width: 25%; border-radius: 6px;">
                    <p class="top3-locations" style="margin-top: 6px; font-size: 1vw"><i class="fa-solid fa-location-dot" style="color: #5b5b5b; margin-right: 2px; 
                    margin-left: 15px;"></i> <span data-lang="top_3_locations">top 3 locations</span></p>
                    <p data-lang="by_user_density" style=" margin-left: 14%; font-size: 1vw; margin-bottom: 6%; color:rgb(38, 152, 57)">by user density</p>
                    <div class="location-list-stack">
                      <p style="font-size: 1.2vw; margin-top: 2%; color:rgb(31, 7, 116); text-align: center;">1. {{number1location}}</p>
                      <p style="font-size: 1.2vw; margin-top: 2%; color:rgb(31, 7, 116); text-align: center;">2. {{number2location}}</p>
                      <p style="font-size: 1.2vw; margin-top: 2%; color:rgb(31, 7, 116); text-align: center;">3. {{number3location}}</p>
                    </div>
                  
                    <!-- Inline version for small screens -->
                    <p class="location-list-inline" style="font-size: 1.3vw; color:rgb(31, 7, 116); text-align: center; display: none;">
                      1. {{number1location}}, 2. {{number2location}}, 3. {{number3location}}
                    </p>
                  
                  </div>
                </div>
                <div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%; height: 20vw; margin-top: 10px;">  
                  <div class="image-container_" style="background-color: rgba(255, 255, 255, 0.9); overflow: hidden; border-radius: 6px; display: flex; flex-direction: column; width: 100%;">
                    <p style="margin-top: 6px; font-size: 13px; flex-shrink: 0;">
                      <i class="fa-solid fa-globe" style=" color: #5b5b5b; margin-right: 2px; margin-left: 15px;"></i> <span data-lang="user_density_map">user density map</span> 
                    </p>
                    <iframe src="/map" style="border: none; flex-grow: 1; margin-right: 8px "></iframe>
                  </div>
                </div>
              </div>
            </div>
            <!-- Right Column with Charts -->
           
            <div class="right-column charts-container" style="flex: 1; max-width: 45%; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; gap: 10px; ">
              <div class="chart-box" style="background-color: rgba(255, 255, 255, 0.9); width: 100%; height: 16vw; border-radius: 6px; display: flex; flex-direction: column; align-items: center; overflow: hidden;">
                <p data-lang="product_category_chart_label" style="font-size:11px; text-align: center; margin-top:6px">product category frequency /{{previous_monday_year}}-{{previous_monday_month}}-{{previous_monday_day}} to {{today_year}}-{{today_month}}-{{today_day}}/ </p>
                <canvas id="myChart" style="width: 100%; height: 100%;"></canvas>
              </div>
              <div class="chart-box" style="background-color: rgba(255, 255, 255, 0.9); width: 100%; height: 16vw; border-radius: 6px; display: flex; flex-direction: column; align-items: center; overflow: hidden;">
                <p data-lang="manufacturer_chart_label" style="font-size: 11px; text-align: center; margin-top:6px">manufacturer frequency /{{previous_monday_year}}-{{previous_monday_month}}-{{previous_monday_day}} to {{today_year}}-{{today_month}}-{{today_day}}/ </p>
                <canvas id="myChart2" style="width: 100%; height: 100%;"></canvas>
              </div>
            
            </div>
          </div>
        
      </div>
      
    </section>
    
    <!-- <iframe id="chatIframe" src="https://chatbothungarianbv.azurewebsites.net" frameborder="0"></iframe> -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js" integrity="sha512-UXumZrZNiOwnTcZSHLOfcTs0aos2MzBWHXOHOuB0J/R44QB0dwY5JgfbvljXcklVf65Gc4El6RjZ+lnwd2az2g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js" integrity="sha512-wUYbRPLV5zs6IqvWd88HIqZU/b8TBx+I8LEioQ/UC0t5EMCLApqhIAnUg7EsAzdbhhdgW07TqYDdH3QEXRcPOQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="\static\inactivitytimeout.js"></script>

    <script>
     
      
    document.addEventListener("DOMContentLoaded", function() {
      const formOpenBtn = document.querySelector("#form-open");
      logoutButton = document.querySelector("#logout");
      home = document.querySelector(".home");
      formContainer = document.querySelector(".form_container");
      formCloseBtn = document.querySelector(".form_close");
      signupBtn = document.querySelector("#signup");
      var homeButton = document.querySelector("#home");
      circleDashboardLink0= document.getElementById('circleDashboardLink0');

          // Translation object
      const translations = {
        en: {

            // 1. slide

            home: "Home",
            customdatemetrics: "Advanced analytics",
            weektodatequickoverview:"Week-to-Date Quick Overview",
            
            startdateyear: "Year (2024)",
            startdatemonth: "Month (01)",
            startdateday: "Day (01)",
            startdatehour: "Hour (00)",
            startdateminute: "Minute (00)",
            startdatesecond: "Second (00)",
            pleasespecifytheenddate: "Please specify the end date:",
            enddateyear: "Year (2024)",
            enddatemonth: "Month (02)",
            enddateday: "Day (01)",
            enddatehour: "Hour (00)",
            enddateminute: "Minute (00)",
            enddatesecond: "Second (00)",
            trackedperiod: "Please specify the periods you want to track:",
            pleasespecifythestartdate: "Please specify the start date:",
            yearly: "Yearly",
            monthly: "Monthly",
            weekly: "Weekly",
            daily: "Daily",
            submit_: "Submit",
            dashboard: "Dashboard",
            product_category_chart_label: "Product category frequency /{{previous_monday_year}}-{{previous_monday_month}}-{{previous_monday_day}} to {{today_year}}-{{today_month}}-{{today_day}}/",
            manufacturer_chart_label: "Manufacturer frequency /{{previous_monday_year}}-{{previous_monday_month}}-{{previous_monday_day}} to {{today_year}}-{{today_month}}-{{today_day}}/",


            users: "users",
            vs_previous_week: "vs previous week",
            query: "query",
            on_average: "on average",
            per_user: "per user",
            chats: "chats",
            click: "click",
            to_read: "to read",
            this_week_chats: "this week's chats",
            top_3_locations: "top 3 locations",
            by_user_density: "by user density",
            user_density_map: "user density map",
           
            myservice: "My Services",
            chatcontrol:"Chat Control",
            metrics:"ChatBot Metrics & Insights",
            prediction:"Advanced AI Predictive Solutions",
           


            
            
            logout:"Logout",
          },
        hu: {
            // 1. slide
            home:"Kezdőlap",
            customdatemetrics: "Részletes elemzés",
            weektodatequickoverview:"Heti gyorselemzés",

      
            startdateyear: "Év (2024)",
            startdatemonth: "Hónap (01)",
            startdateday: "Nap (01)",
            startdatehour: "Óra (00)",
            startdateminute: "Perc (00)",
            startdatesecond: "Másodperc (00)",
            pleasespecifythestartdate: "Kérlek add meg a kezdő dátumot:",
            pleasespecifytheenddate: "Kérlek add meg a záró dátumot:",
            enddateyear: "Év (2024)",
            enddatemonth: "Hónap (02)",
            enddateday: "Nap (01)",
            enddatehour: "Óra (00)",
            enddateminute: "Perc (00)",
            enddatesecond: "Másodperc (00)",
            trackedperiod: "Add meg, hogy milyen időbontást szeretnél:",
            yearly: "Éves",
            monthly: "Havi",
            weekly: "Heti",
            daily: "Napi",
            submit_: "Beküldés",

            users: "felhasználók",
            vs_previous_week: "előző héthez képest",
            query: "lekérdezés",
            on_average: "átlagosan",
            per_user: "felhasználónként",
            chats: "csevegések",
            click: "kattints",
            to_read: "a részletekért",
            this_week_chats: "e heti csevegések",
            top_3_locations: "top 3 helyszín",
            by_user_density: "felhasználók száma szerint",
            user_density_map: "felhasználók eloszlása",
            product_category_chart_label: "Termékkategória gyakoriság /{{previous_monday_year}}-{{previous_monday_month}}-{{previous_monday_day}}-tól {{today_year}}-{{today_month}}-{{today_day}}-ig/",
            manufacturer_chart_label: "Gyártói gyakoriság /{{previous_monday_year}}-{{previous_monday_month}}-{{previous_monday_day}}-tól {{today_year}}-{{today_month}}-{{today_day}}-ig/",

            



            dashboard: "Kezelőfelület",
            chatcontrol:"Chatfelügyelet",
            metrics:"Chatbot mutatók és elemzések", 
            prediction:"Prediktív AI-megoldások",
            
            
            
              
            logout:"Kijelentkezés",       
        }
      };

      document.getElementById('lang-en').addEventListener('click', function() {
        const newLang = 'en';
        localStorage.setItem('language', newLang);
        setLanguage(newLang);
        
        fetch('/update_language', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ user_id: currentUserId, language: newLang}),
          credentials: 'include'
        });
      });

      document.getElementById('lang-hu').addEventListener('click', function() {
        const newLang = 'hu';
        localStorage.setItem('language', newLang);
        setLanguage(newLang);
        
        fetch('/update_language', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({language: newLang}),
          credentials: 'include'
        });
      });

      // Set language on page load
      window.onload = function() {
          if (typeof translations !== 'undefined') {
              // Use backend-provided language if available, otherwise use localStorage, otherwise default to 'hu'
              const backendLang = "{{ language }}"; // Jinja variable
              const storedLang = localStorage.getItem('language');
              const language = backendLang && backendLang !== "" ? backendLang : (storedLang || 'hu');

              setLanguage(language);
          }
      };

      function setLanguage(language) {
        console.log("Setting language:", language);
        document.querySelectorAll('[data-lang]').forEach(element => {
          const langKey = element.getAttribute('data-lang');
          const translation = translations[language][langKey];

          if (translation) {
            if (element.hasAttribute('placeholder')) {
              // For inputs like <input placeholder="...">
              element.setAttribute('placeholder', translation);
            }else if(element.tagName === "INPUT" && element.type === "submit") {
            // For submit buttons
            element.value = translation;
              
            } else {
              // For regular elements like <div>, <span>, etc.
              element.innerHTML = translation;
            }
          }
        });
      }

  
     
     
     
      circleDropdownContent = document.getElementById('circleDropdownContent');
      circleDropdown = document.getElementById('circleDropdown');
      circleDashboardLink= document.getElementById('circleDashboardLink');
      circleDashboardLink2= document.getElementById('circleDashboardLink2');


      formOpenBtn.addEventListener("click", () => home.classList.add("show"));
      formCloseBtn.addEventListener("click", () => home.classList.remove("show"));


      if (circleDashboardLink0){
        circleDashboardLink0.addEventListener("click", function() {
            const firstCharacterElement = document.querySelector("#circleDropdown .content");

            if (!firstCharacterElement) {
                console.error("circleDropdown .content NOT found.");
                return;
            }

            const firstCharacter = firstCharacterElement.innerText.trim();
            console.log("Sending firstCharacter:", firstCharacter);

            // Append first_character as a query parameter to the URL
            const url = `/chatAdminPage?first_character=${encodeURIComponent(firstCharacter)}`;

            // Redirect to the URL
            window.location.href = url;
        });
      }

  



      function showDropdown(dropdown, button) {
        dropdown.style.display = 'block';
        button.classList.add('active');
    }

    function hideDropdown(dropdown, button) {
        dropdown.style.display = 'none';
        button.classList.remove('active');
    }

    

    // For V character dropdown
    circleDropdown.addEventListener('mouseenter', function() {
        showDropdown(circleDropdownContent, circleDropdown);
    });

    circleDropdown.addEventListener('mouseleave', function() {
        setTimeout(function() {
            if (!circleDropdownContent.matches(':hover') && !circleDropdown.matches(':hover')) {
                hideDropdown(circleDropdownContent, circleDropdown);
            }
        }, 200); // Delay to ensure dropdown doesn't vanish immediately
    });

    circleDropdownContent.addEventListener('mouseleave', function() {
        setTimeout(function() {
            if (!circleDropdown.matches(':hover')) {
                hideDropdown(circleDropdownContent, circleDropdown);
            }
        }, 200); // Delay to ensure dropdown doesn't vanish immediately
    });

    circleDropdownContent.addEventListener('mouseenter', function() {
        showDropdown(circleDropdownContent, circleDropdown);
    });

//     window.addEventListener('message', function (event) {
//     // Check the origin to ensure the message is from a trusted source
//     if (event.origin === "https://chatbothungarianbv.azurewebsites.net") {
//         if (event.data.type === 'chatExpanded') {
//             document.getElementById('chatIframe').style.height = event.data.height +'px';
//         } else if (event.data.type === 'chatCollapsed') {
//             document.getElementById('chatIframe').style.height = event.data.height + 'px';
//         }
//     }
// });



                        ////////////////////////////////////////////////////////////////////
                        //                POSITIONING THE IFRAME                          //
                        ////////////////////////////////////////////////////////////////////


                        
window.addEventListener('message', function (event) {
    if (event.origin === "https://chatbothungarianbv.azurewebsites.net") {
        var chatIframe = document.getElementById('chatIframe');
        
        if (event.data.type === 'chatExpanded') {
            chatIframe.style.width = event.data.width + 'px';
            chatIframe.style.height = event.data.height + 'px';
           // chatIframe.style.transform = 'scale(1)'; // Reset to normal scale
        } else if (event.data.type === 'chatCollapsed') {
            // Calculate scale based on desired dimensions
            let scaleX = 56 / event.data.width;
            let scaleY = 52 / event.data.height;

            // Set the scale transformation
            chatIframe.style.transform = `scale(${scaleX}, ${scaleY})`;

            // Alternatively, you can set width and height directly, but you may see movement
            // chatIframe.style.width = '56px'; // Collapsed width
            // chatIframe.style.height = '52px'; // Collapsed height
        }

        // Ensure the origin of the transform is set
        chatIframe.style.transformOrigin = 'bottom right';
    }
});



    homeButton.addEventListener("click", function() {
        // Navigate to the "/" route
        window.location.href = "/";
    });

      logoutButton.addEventListener("click", function () {
          // Navigate to the "/logout" route
          window.location.href = "/logout";

          const adjustIFrameSize = (height, width) => {
              const iframe = document.getElementById('chatIframe');
              iframe.style.height = height + 'px';
              iframe.style.width = width + 'px';
          };
      });
      

      var usernumber = {{  usernumber }};
      var usernumber_previous_week = {{ usernumber_previousweek }};

      usernumber = Number(usernumber);
      usernumber_previous_week = Number(usernumber_previous_week);

      // Update the usernumber element
      document.getElementById('usernumber').textContent = usernumber;

      // Calculate the percentage difference
      // Calculate the percentage difference
      let percentageDifference = 0;
      if (usernumber_previous_week === 0) {
          if (usernumber > 0) {
              percentageDifference = 100; // If previous week was 0 and now it's positive, assume 100% growth
          } else {
              percentageDifference = 0; // If both weeks are 0, no change
          }
      } else {
          percentageDifference = ((usernumber - usernumber_previous_week) / usernumber_previous_week) * 100;
      }

      // Update the percentage element
      const percentageElement = document.getElementById('percentage');
      if (usernumber > usernumber_previous_week) {
          percentageElement.style.color = 'rgb(38, 152, 57)'; // Green color
          percentageElement.innerHTML = `<i class="fa-solid fa-arrow-up"></i> ${percentageDifference.toFixed(2)}%`;
      } else {
          percentageElement.style.color = 'rgb(255, 0, 0)'; // Red color
          percentageElement.innerHTML = `<i class="fa-solid fa-arrow-down"></i> ${percentageDifference.toFixed(2)}%`;
      }

     
      // DATE
      function setupFlatpickr(yearField, monthField, dayField) {
        flatpickr(yearField, {
            dateFormat: "Y-m-d",
            onChange: function(selectedDates, dateStr) {
                const date = new Date(dateStr);
                yearField.value = date.getFullYear();
                monthField.value = String(date.getMonth() + 1).padStart(2, '0');
                dayField.value = String(date.getDate()).padStart(2, '0');
            }
        });
    }

    // Get the input fields
    const yearStart = document.querySelector('input[name="year_start"]');
    const monthStart = document.querySelector('input[name="month_start"]');
    const dayStart = document.querySelector('input[name="day_start"]');

    const yearEnd = document.querySelector('input[name="year_end"]');
    const monthEnd = document.querySelector('input[name="month_end"]');
    const dayEnd = document.querySelector('input[name="day_end"]');

    // Initialize Flatpickr on start date fields
    setupFlatpickr(yearStart, monthStart, dayStart);

    // Initialize Flatpickr on end date fields
    setupFlatpickr(yearEnd, monthEnd, dayEnd);

    document.getElementById('submitForm').addEventListener('submit', function(event) {
        // Fields to check
        const fieldsToCheck = ['hour', 'minutes', 'seconds', 'hour_end', 'minutes_end', 'seconds_end'];

        fieldsToCheck.forEach(field => {
            const input = document.querySelector(`input[name="${field}"]`);
            if (input && !input.value) {
                input.value = '00'; // Set default value
            }
        });
  
    });

    document.getElementById('form-open').addEventListener('click', function(event) {
        // Reset the form
        document.getElementById('submitForm').reset();
    });


    
      // CHARTJS
      

      const moveChart = {
  id: 'moveChart',
  afterEvent(chart, args) {
    const { canvas, chartArea: { left, right, top, height } } = chart;
    canvas.addEventListener('mousemove', (event) => {
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;

      if ((x >= left - 15 && x <= left + 15 && y >= height / 2 + top - 15 && y <= height / 2 + top + 15) ||
        (x >= right - 15 && x <= right + 15 && y >= height / 2 + top - 15 && y <= height / 2 + top + 15)) {
        canvas.style.cursor = 'pointer';
      } else {
        canvas.style.cursor = 'default';
      }
    });
  },
  afterDraw(chart, args, pluginOptions) {
    const { ctx, chartArea: { left, right, top, height } } = chart;

    class CircleChevron {
      draw(ctx, x, pixel) {
        const angle = Math.PI / 180;
        ctx.beginPath();
        ctx.lineWidth = 3;
        ctx.strokeStyle = 'rgba(102, 102, 0.5)';
        ctx.fillStyle = 'white';
        ctx.arc(x, height / 2 + top, 12, angle * 0, angle * 360, false);
        ctx.stroke();
        ctx.fill();
        ctx.closePath();

        ctx.beginPath();
        ctx.lineWidth = 3;
        ctx.strokeStyle = 'rgba(255, 99, 132, 1)';
        ctx.moveTo(x + pixel, height / 2 + top - 7.5);
        ctx.lineTo(x - pixel, height / 2 + top);
        ctx.lineTo(x + pixel, height / 2 + top + 7.5);
        ctx.stroke();
        ctx.closePath();
      }
    }

    let drawCircleLeft = new CircleChevron();
    drawCircleLeft.draw(ctx, left, 5);

    let drawCircleRight = new CircleChevron();
    drawCircleRight.draw(ctx, right, -5);

    if (chart.legend) {
      chart.legend.options.display = false;
      chart.legend.draw();
    }
  }
};

const mainChartData00 = {{ mainChartData0 | tojson }};

function transformData(data) {
  const mappedData = data.map(item => ({
    x: item.label,
    y: item.mainChartData[0].y
  }));

  mappedData.sort((a, b) => b.y - a.y);

  return mappedData;
}

const mainChartData = transformData(mainChartData00);

function getRandomColor() {
  const r = Math.floor(Math.random() * 255);
  const g = Math.floor(Math.random() * 255);
  const b = Math.floor(Math.random() * 255);
  return `rgba(${r}, ${g}, ${b}, 0.2)`;
}

const backgroundColors = mainChartData.map(() => getRandomColor());
const borderColors = backgroundColors.map(color => color.replace('0.2', '1'));

var ctx = document.getElementById('myChart').getContext('2d');
var myChart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: mainChartData.map(item => item.x),
    datasets: [{
      
      data: mainChartData.map(item => item.y),
      backgroundColor: backgroundColors,
      borderColor: borderColors,
      borderWidth: 1
    }]
  },
  options: {
    layout: {
      padding: {
        right: 18
      }
    },
    scales: {
      x: {
        min: 0,
        max: 6,
        ticks: {
          font: {
            size: 0.9 * window.innerWidth / 100 // Example: 1.2% of viewport width
          }
        }
      },
      y: {
        beginAtZero: true,
        ticks:{
          stepSize:1,
          callback: function(value){
            return Number.isInteger(value) ? value : '';
          }
        }
      }
    }
  },
  plugins: [moveChart]
});

function moveScroll(event) {
  const { chartArea: { left, right, top, height }, options, data } = myChart;
  const rect = myChart.canvas.getBoundingClientRect();
  const x = event.clientX - rect.left;
  const y = event.clientY - rect.top;

  if (x >= left - 15 && x <= left + 15 && y >= height / 2 + top - 15 && y <= height / 2 + top + 15) {
    options.scales.x.min = options.scales.x.min - 7;
    options.scales.x.max = options.scales.x.max - 7;
    if (options.scales.x.min <= 0) {
      options.scales.x.min = 0;
      options.scales.x.max = 6;
    }
  } else if (x >= right - 15 && x <= right + 15 && y >= height / 2 + top - 15 && y <= height / 2 + top + 15) {
    options.scales.x.min = options.scales.x.min + 7;
    options.scales.x.max = options.scales.x.max + 7;
    const maxDataY = Math.max(...mainChartData.map(item => item.y));
    options.scales.y.max = maxDataY;
    if (options.scales.x.max >= data.datasets[0].data.length) {
      options.scales.x.min = data.datasets[0].data.length - 7;
      options.scales.x.max = data.datasets[0].data.length;
    }
  }
  myChart.update();
}

function handleResize() {
  myChart.canvas.removeEventListener('click', moveScroll);
  setTimeout(() => {
    myChart.canvas.addEventListener('click', moveScroll);
  }, 500);
}

window.addEventListener('load', () => {
        if (myChart) {
          myChart.resize(); // Ensure initial render is correct
          myChart.update(); // Re-render after resizing
        }
      });
      window.addEventListener('resize', handleResize);
      window.addEventListener('scroll', handleResize);

      myChart.canvas.addEventListener('click', moveScroll);


    //Chart II
    const manufacturerData00 = {{ manufacturer|tojson }};

function transformData2(data) {
  const mappedData = data.map(item => ({
    x: item.x.substring(0, 15),  // Truncate x to 15 characters
    y: item.y
  }));
  mappedData.sort((a, b) => b.y - a.y);
  return mappedData;
}

const manufacturerData = transformData2(manufacturerData00);

const backgroundColorsManufacturer = manufacturerData.map(() => getRandomColor());
const borderColorsManufacturer = backgroundColorsManufacturer.map(color => color.replace('0.2', '1'));

var ctxManufacturer = document.getElementById('myChart2').getContext('2d');
var myChartManufacturer = new Chart(ctxManufacturer, {
  type: 'bar',
  data: {
    labels: manufacturerData.map(item => item.x),
    datasets: [{
     
      data: manufacturerData.map(item => item.y),
      backgroundColor: backgroundColorsManufacturer,
      borderColor: borderColorsManufacturer,
      borderWidth: 1
    }]
  },
  options: {
    layout: {
      padding: {
        right: 18
      }
    },
    scales: {
      x: {
        min: 0,
        max: 6,
        ticks: {
          font: {
            size: 0.9 * window.innerWidth / 100 // Example: 1.2% of viewport width
          }
        }
      },
      y: {
        beginAtZero: true,
        ticks:{
          stepSize:1,
          callback: function(value){
            return Number.isInteger(value) ? value : '';
          }
        }
      }
    }
  },
  plugins: [moveChart]
});

function moveScrollManufacturer(event) {
  const { chartArea: { left, right, top, height }, options, data } = myChartManufacturer;
  const rect = myChartManufacturer.canvas.getBoundingClientRect();
  const x = event.clientX - rect.left;
  const y = event.clientY - rect.top;

  if (x >= left - 15 && x <= left + 15 && y >= height / 2 + top - 15 && y <= height / 2 + top + 15) {
    options.scales.x.min = options.scales.x.min - 7;
    options.scales.x.max = options.scales.x.max - 7;
    if (options.scales.x.min <= 0) {
      options.scales.x.min = 0;
      options.scales.x.max = 6;
    }
  } else if (x >= right - 15 && x <= right + 15 && y >= height / 2 + top - 15 && y <= height / 2 + top + 15) {
    options.scales.x.min = options.scales.x.min + 7;
    options.scales.x.max = options.scales.x.max + 7;
    const maxDataY = Math.max(...manufacturerData.map(item => item.y));
    options.scales.y.max = maxDataY;
    if (options.scales.x.max >= data.datasets[0].data.length) {
      options.scales.x.min = data.datasets[0].data.length - 7;
      options.scales.x.max = data.datasets[0].data.length;
    }
  }
  myChartManufacturer.update();
}


function handleResizeManufacturer() {
  myChartManufacturer.canvas.removeEventListener('click', moveScroll);
        setTimeout(() => {
          myChartManufacturer.canvas.addEventListener('click', moveScroll);
        }, 500);
        adjustPadding(myChartManufacturer, mainChartData);
      }
      window.addEventListener('load', () => {
        if (myChartManufacturer) {
          myChartManufacturer.resize(); // Ensure initial render is correct
          myChartManufacturer.update(); // Re-render after resizing
        }
      });
      window.addEventListener('resize', handleResizeManufacturer);
      window.addEventListener('scroll', handleResizeManufacturer);

      myChartManufacturer.canvas.addEventListener('click', moveScroll);

  



    circleDashboardLink.addEventListener("click", function() {
        // Navigate to the "/dashboard" route
        window.location.href = "/dashboard";
    });

    circleDashboardLink2.addEventListener("click", function() {
        // Navigate to the "/dashboard" route
        window.location.href = "/predictive_dashboard";
    });



 
      

  });

    

    </script>
    <script>
      // Dot animation for "Loading..."
      let dotCount = 0;
      const loadingText = document.getElementById('loadingText');
      const dotInterval = setInterval(() => {
        dotCount = (dotCount + 1) % 4;
        loadingText.textContent = 'Loading' + '.'.repeat(dotCount);
      }, 500);

      // When page is fully loaded, hide overlay and remove blur
      window.addEventListener('load', function () {
        clearInterval(dotInterval);
        document.getElementById('loadingOverlay').style.display = 'none';
        document.body.classList.remove('loading');
      });

      // Show overlay on form submit
      const metricsForm = document.getElementById('submitForm');
      if (metricsForm) {
        metricsForm.addEventListener('submit', function () {
          document.getElementById('loadingOverlay').style.display = 'flex';
        });
      }
    </script>

  </body>
</html>